function clean_css_value(e){var t=/^(\d+(?:\.\d*)?|\.\d+)([^\d\s]+)?$/m;if(!(m=e.match(t)))return defSize;if(!m[1])return"";var r=Math.floor(m[1]);if(!m[2])return r+"px";switch(m[2]){case"em":case"%":return m[1]+m[2];case"px":default:return r+"px"}}function getColorBgVal(e){myWidgetData.QrColorBg=e.value;var t=getQrImage(myWidgetData);domPreviewImg.src=t,domPreviewImgAdv.src=t}function getColorPtVal(e){myWidgetData.QrColorPt=e.value;var t=getQrImage(myWidgetData);domPreviewImg.src=t,domPreviewImgAdv.src=t}function getBorderColor(e){domPreviewImg.setAttribute("cke_qr_borderColor",e.value),domPreviewImg.style.borderColor=e.value,domPreviewImgAdv.style.borderColor=e.value}function getborderWidth(e){var t=e.value+"px";domPreviewImg.getAttribute("cke_qr_defCellSize");domPreviewImg.setAttribute("cke_qr_borderWidth",e.value),domPreviewImg.style.borderWidth=t,domPreviewImgAdv.style.borderWidth=t}function getborderSpace(e){myWidgetData.QrMargin=e.value;var t=getQrImage(myWidgetData);domPreviewImg.src=t,domPreviewImgAdv.src=t}function qrStrChanged(e,t){if(""==e.value.trim())return alert(t),!1;myWidgetData.QrUrl=e.value;var r=getQrImage(myWidgetData);domPreviewImg.src=r,domPreviewImgAdv.src=r}function getHtmlPreview(e,t){var r="";return r+='<div style="width: 70%; border-radius: 10px; text-align: center;margin: auto;border: 2px solid gray;">',r+='<p style="font-weight: bold;text-align: center;">'+t+"</p>",r+='<img id="previewImg_'+e+'" src="" alt="QR Code" style="width: 50%; border:5px solid black">',r+="</div>"}function getHtmlBorder(e,t,r,a){var l=t+"_vId",o='<form style="text-align: center;">';return o+='<input type="range" style="vertical-align: middle; width: 50%; " name="'+t+'" min="'+r+'" max="'+a+'" ',o+='onchange="get'+t+'(this);" oninput="document.getElementById(\''+l+'\').innerText = this.value;" value="5">',o+='<span style="font-weight: bold; margin-left: 15px;">'+e+"</span>",o+='<span id="'+l+'" style="font-weight: bold; margin-left: 15px; color: tomato;">VALUE</span>',o+='<span style="font-weight: bold; color: tomato;"> Px</span>',o+="</form>"}function getHtmlColor(e,t){var r='<form style="text-align: center;">';return r+='<input type="color" style=" width: 50px; height: 20px; border:1px black solid;  vertical-align: middle;" onchange="',r+=e+'" name="colorBg" value="#000000"><span style="font-weight: bold; margin-left: 15px;">'+t+"</span>",r+="</form>"}function getHtmlCorrectionLevel(e,t,r,a,l){var o='<div style="border: 1px solid red; padding:5px; border-radius: 10px;">';return o+='<p style="text-align: center; font-weight: bold;color: tomato;">'+e+"</p>",o+='<form style="text-align: center;">',o+='<input type="radio" name="cor_level" value="L" onclick="handleCLClick(this);">&nbsp;&nbsp;'+t+"&nbsp;&nbsp;",o+='<input type="radio" name="cor_level" value="M" onclick="handleCLClick(this);">&nbsp;&nbsp;'+r+"&nbsp;&nbsp;",o+='<input type="radio" name="cor_level" value="Q" onclick="handleCLClick(this);">&nbsp;&nbsp;'+a+"&nbsp;&nbsp;",o+='<input type="radio" name="cor_level" value="H" onclick="handleCLClick(this);">&nbsp;&nbsp;'+l+"&nbsp;&nbsp;",o+="</form><div>"}function getQrStrHtml(e,t){var r=e+"<br>";return r+='<input class="cke_dialog_ui_input_text" id="cke_qstring" type="text" value=""',r+='name="QR String" onchange="qrStrChanged(this,\''+t+"')\">"}function setSelectedValue(e,t){for(var r=e.getElement("tab-adv","correctionLevel").getElementsByTag("form").$[0].elements.namedItem("cor_level"),a=0;a<r.length;a++)if(r[a].value==t){r[a].checked=!0;break}}function getSelectedValue(e){for(var t=e.getElement("tab-adv","correctionLevel").getElementsByTag("form").$[0].elements.namedItem("cor_level"),r=0;r<t.length;r++)if(t[r].checked)return t[r].value}function handleCLClick(e){myWidgetData.QrCorLevel=e.value;var t=getQrImage(myWidgetData);domPreviewImg.src=t,domPreviewImgAdv.src=t}var domPreviewImg=null,domPreviewImgAdv=null,myWidgetData=null;CKEDITOR.dialog.add("yaqr",function(e){return{title:e.lang.yaqr.qrProp,minWidth:400,minHeight:200,contents:[{id:"tab-basic",label:e.lang.yaqr.basicSettings,elements:[{type:"html",id:"preview",html:getHtmlPreview("ref",e.lang.yaqr.preview),setup:function(e){myWidgetData=Object.assign({},e.data);var t=this.getDialog().getContentElement("tab-basic","preview");previewImg_ref=t.domId;var r=document.getElementById(previewImg_ref);(domPreviewImg=r.getElementsByTagName("img")[0]).src=getQrImage(myWidgetData)},commit:function(e){}},{type:"html",id:"qrString",label:"qrString",html:getQrStrHtml(e.lang.yaqr.qrString,e.lang.yaqr.qrString+" "+e.lang.yaqr.badQRmsg),setup:function(e){document.getElementById("cke_qstring").value=e.data.QrUrl},commit:function(e){e.setData("QrUrl",document.getElementById("cke_qstring").value)}},{type:"checkbox",id:"target",label:e.lang.yaqr.targetText,default:"checked",setup:function(e){this.setValue("_blank"===e.data.QrUrlTarget)},commit:function(e){var t="_self";this.getValue()&&(t="_blank"),e.setData("QrUrlTarget",t)}},{type:"text",id:"qrSize",label:e.lang.yaqr.qrSizeLabel,validate:CKEDITOR.dialog.validate.notEmpty(e.lang.yaqr.qrSizeLabel+" "+e.lang.yaqr.badQRmsg),setup:function(e){this.setValue(clean_css_value(e.data.QRSize))},commit:function(e){var t=clean_css_value(this.getValue());e.setData("QRSize",t)}}]},{id:"tab-adv",label:e.lang.yaqr.advSettings,elements:[{type:"html",id:"preview",html:getHtmlPreview("adv",e.lang.yaqr.preview),setup:function(e){var t=this.getDialog().getContentElement("tab-adv","preview");previewImg_adv=t.domId;var r=document.getElementById(previewImg_adv);(domPreviewImgAdv=r.getElementsByTagName("img")[0]).src=getQrImage(myWidgetData)},commit:function(e){}},{type:"vbox",title:e.lang.yaqr.setQrTitle,style:"border: 1px solid tomato; border-radius: 10px; text-align: center;",children:[{type:"html",id:"borderQR",style:"text-align: center; font-weight: bold;color: tomato;",html:"<p>"+e.lang.yaqr.qrPropColor+"</p>"},{type:"html",id:"colorBg",label:"colorBg",html:getHtmlColor("getColorBgVal(this)",e.lang.yaqr.backColor),style:"text-align: center;",setup:function(e){this.getElement("tab-adv","colorBg").getElementsByTag("input").$[0].value=e.data.QrColorBg},commit:function(e){var t=this.getElement("tab-adv","colorBg").getElementsByTag("input").$[0].value;e.setData("QrColorBg",t)}},{type:"html",id:"colorPt",label:"colorPt",html:getHtmlColor("getColorPtVal(this)",e.lang.yaqr.ptColor),setup:function(e){this.getElement("tab-adv","colorPt").getElementsByTag("input").$[0].value=e.data.QrColorPt},commit:function(e){var t=this.getElement("tab-adv","colorPt").getElementsByTag("input").$[0].value;e.setData("QrColorPt",t)}}]},{type:"vbox",title:e.lang.yaqr.setBPTitle,style:"border: 1px solid tomato; border-radius: 10px; text-align: center;",children:[{type:"html",id:"borderTitle",style:"text-align: center; font-weight: bold;color: tomato;",html:"<p>"+e.lang.yaqr.borderProp+"</p>"},{type:"html",id:"borderColor",label:"borderColor",html:'<p><input type="color" style=" width: 50px; height: 20px; border:1px black solid;  vertical-align: middle;" onchange="getBorderColor(this)" name="borderColor" value="#000000"><span style="font-weight: bold; margin-left: 15px;">'+e.lang.yaqr.borderColor+"</span></p>",style:"text-align: center;",setup:function(e){this.getElement("tab-adv","borderColor").getElementsByTag("input").$[0].value=e.data.QrBorderColor,domPreviewImg.style.borderColor=e.data.QrBorderColor,domPreviewImgAdv.style.borderColor=e.data.QrBorderColor},commit:function(e){var t=this.getElement("tab-adv","borderColor").getElementsByTag("input").$[0].value;e.setData("QrBorderColor",t)}},{type:"html",id:"borderWidth",label:"borderWidth",html:getHtmlBorder(e.lang.yaqr.borderWidth,"borderWidth",0,10),setup:function(e){this.getElement("tab-adv","borderWidth").getElementsByTag("input").$[0].value=e.data.QrBorderWidth,document.getElementById("borderWidth_vId").innerText=e.data.QrBorderWidth,domPreviewImg.style.borderWidth=e.data.QrBorderWidth+"px",domPreviewImgAdv.style.borderWidth=e.data.QrBorderWidth+"px"},commit:function(e){var t=this.getElement("tab-adv","borderWidth").getElementsByTag("input").$[0].value;e.setData("QrBorderWidth",t)}},{type:"html",id:"borderSpace",label:"borderSpace",html:getHtmlBorder(e.lang.yaqr.borderSpace,"borderSpace",0,100),setup:function(e){this.getElement("tab-adv","borderSpace").getElementsByTag("input").$[0].value=e.data.QrMargin,document.getElementById("borderSpace_vId").innerText=e.data.QrMargin},commit:function(e){var t=this.getElement("tab-adv","borderSpace").getElementsByTag("input").$[0].value;e.setData("QrMargin",t)}}]},{type:"html",id:"correctionLevel",title:e.lang.yaqr.setECLTitle,label:"correctionLevel",html:getHtmlCorrectionLevel(e.lang.yaqr.corLevel,e.lang.yaqr.low,e.lang.yaqr.medium,e.lang.yaqr.quality,e.lang.yaqr.high),setup:function(e){console.log("setup tab-adv correctionLevel ",e.data.QrCorLevel),setSelectedValue(this,e.data.QrCorLevel)},commit:function(e){this.getElement("tab-adv","correctionLevel").getElementsByTag("form").$[0];var t=getSelectedValue(this);console.log("commit tab-adv correctionLevel ",t),e.setData("QrCorLevel",t)}}]}]}});